#include <iostream>
#include <fstream>
#include <sstream>
#include <math.h>

#include "FIR.h"

using namespace std;

#define FILTER_LENGTH 25

static float coeff[]=
{
0.008343267095683986,
0.007149583224306668,
0.0014492517668356205,
-0.01331060569409418,
-0.0345042249128654,
-0.053675798671946655,
-0.05866861647110748,
-0.03857434732652085,
0.01033141819616749,
0.08087666209830395,
0.15569629640166371,
0.2128725965553248,
0.23427451265344562,
0.2128725965553248,
0.15569629640166371,
0.08087666209830395,
0.01033141819616749,
-0.03857434732652085,
-0.05866861647110748,
-0.053675798671946655,
-0.0345042249128654,
-0.01331060569409418,
0.0014492517668356205,
0.007149583224306668,
0.008343267095683986,
};

static float in[]=
{
0.000262,
0.000262,
-0.000270,
-0.000270,
0.000395,
0.000395,
-0.000004,
0.000529,
0.000529,
-0.000670,
-0.000670,
-0.000537,
-0.000537,
-0.000004,
-0.000004,
-0.000803,
-0.000803,
-0.000403,
-0.000403,
-0.000936,
-0.000403,
-0.000403,
-0.000803,
-0.000803,
-0.000803,
-0.000803,
0.000662,
0.000662,
0.000662,
0.000662,
0.000529,
0.000529,
0.000262,
0.000395,
0.000395,
-0.000270,
-0.000270,
0.000262,
0.000262,
-0.000537,
-0.000537,
-0.000403,
-0.000403,
0.000129,
0.000129,
-0.000004,
0.000129,
0.000129,
-0.000803,
-0.000803,
-0.000670,
-0.000670,
-0.000537,
-0.000537,
-0.000403,
-0.000403,
-0.000270,
-0.000270,
-0.000137,
-0.000270,
-0.000270,
-0.000137,
-0.000137,
-0.000270,
-0.000270,
0.000129,
0.000129,
-0.000004,
-0.000004,
-0.000803,
-0.000803,
-0.000270,
-0.000537,
-0.000537,
-0.000670,
-0.000670,
-0.000936,
-0.000936,
-0.000403,
-0.000403,
0.000529,
0.000529,
0.000795,
0.000795,
0.000129,
0.000262,
0.000262,
0.000795,
0.000795,
0.000129,
0.000129,
-0.000403,
-0.000403,
0.000129,
0.000129,
0.000262,
0.000262,
0.000795,
0.000662,
0.000662,
0.000662,
0.000662,
-0.000403,
-0.000403,
0.000395,
0.000395,
0.000262,
0.000262,
-0.000403,
-0.000403,
0.000262,
0.000795,
0.000795,
-0.000137,
-0.000137,
0.000129,
0.000129,
-0.000670,
-0.000670,
-0.000537,
-0.000537,
-0.000537,
-0.000537,
-0.000137,
-0.000670,
-0.000670,
-0.000270,
-0.000270,
0.000795,
0.000795,
0.000795,
0.000795,
-0.000137,
-0.000137,
-0.000270,
-0.000270,
0.000262,
-0.000403,
-0.000403,
-0.000004,
-0.000004,
-0.000270,
-0.000270,
-0.000537,
-0.000537,
-0.000537,
-0.000537,
0.000129,
0.000129,
-0.000004,
-0.001069,
-0.001069,
-0.000403,
-0.000403,
-0.000537,
-0.000537,
0.000662,
0.000662,
0.000928,
0.000928,
-0.000137,
-0.000270,
-0.000270,
-0.000270,
-0.000270,
-0.000270,
-0.000270,
-0.001202,
-0.001202,
0.000395,
0.000395,
-0.000270,
-0.000270,
-0.000936,
-0.000137,
-0.000137,
-0.000403,
-0.000403,
-0.000803,
-0.000803,
-0.000403,
-0.000403,
-0.000270,
-0.000270,
-0.001202,
-0.001202,
-0.001202,
-0.001202,
-0.001202,
0.000262,
0.000262,
-0.001069,
-0.001069,
-0.000137,
-0.000137,
-0.000270,
-0.000270,
-0.000403,
-0.000403,
-0.000803,
-0.000537,
-0.000537,
-0.000403,
-0.000403,
-0.000803,
-0.000803,
0.000395,
0.000395,
-0.000137,
-0.000137,
0.000129,
0.000129,
0.000529,
0.000262,
0.000262,
-0.000403,
-0.000403,
-0.000270,
-0.000270,
0.000262,
0.000262,
0.000129,
0.000129,
0.000795,
0.000795,
-0.000004,
-0.000137,
-0.000137,
0.000662,
0.000662,
-0.000403,
-0.000403,
0.000395,
0.000395,
-0.000670,
-0.000670,
-0.000403,
-0.000403,
-0.000670,
-0.000537,
-0.000537,
-0.000670,
-0.000670,
-0.000270,
-0.000270,
0.000262,
0.000262,
0.000529,
0.000529,
0.000928,
0.000928,
0.000928,
-0.000137,
-0.000137,
-0.000137,
-0.000137,
0.000129,
0.000129,
-0.000936,
-0.000936,
-0.001069,
-0.001069,
0.000395,
0.000395,
0.000928,
0.000529,
0.000529,
0.000129,
0.000129,
0.000529,
0.000529,
-0.000537,
-0.000537,
-0.000936,
-0.000936,
-0.001202,
-0.001202,
-0.000270,
0.000395,
0.000395,
0.001061,
0.001061,
0.000262,
0.000262,
0.000129,
0.000129,
0.000129,
0.000129,
0.000662,
0.000662,
0.000795,
0.000129,
0.000129,
-0.000004,
-0.000004,
0.000395,
0.000395,
0.000262,
0.000262,
-0.000403,
-0.000403,
-0.000004,
-0.000004,
-0.000403,
-0.000403,
-0.000403,
-0.000670,
-0.000670,
-0.000670,
-0.000670,
-0.000004,
-0.000004,
-0.000537,
-0.000537,
-0.001069,
-0.001069,
-0.000936,
-0.000270,
-0.000270,
-0.000936,
-0.000936,
-0.000137,
-0.000137,
-0.000403,
-0.000403,
-0.000270,
-0.000270,
-0.000270,
-0.000270,
-0.000270,
0.000129,
0.000129,
-0.000403,
-0.000403,
-0.001336,
-0.001336,
-0.001336,
-0.001336,
-0.000537,
-0.000537,
-0.000137,
-0.000137,
-0.000670,
0.000262,
0.000262,
-0.000137,
-0.000137,
-0.000537,
-0.000537,
-0.000936,
-0.000936,
-0.000004,
-0.000004,
0.000262,
0.000262,
-0.000403,
-0.000004,
-0.000004,
-0.000403,
-0.000403,
-0.000004,
-0.000004,
0.000928,
0.000928,
-0.000137,
-0.000137,
-0.000004,
-0.000004,
-0.000936,
-0.000137,
-0.000137,
0.000262,
0.000262,
-0.000803,
-0.000803,
-0.000137,
-0.000137,
0.000529,
0.000529,
-0.000004,
0.000262,
0.000262,
-0.000670,
-0.000670,
-0.001069,
-0.001069,
-0.000270,
-0.000270,
0.000129,
0.000129,
0.000262,
0.000262,
0.000395,
-0.000537,
-0.000537,
-0.000137,
-0.000137,
-0.000936,
-0.000936,
-0.000270,
-0.000270,
0.000395,
0.000395,
0.000529,
0.000529,
0.000129,
-0.000403,
-0.000403,
-0.000537,
-0.000537,
-0.001202,
-0.001202,
0.000395,
0.000395,
0.000395,
0.000395,
0.000129,
0.000129,
-0.000403,
0.000395,
0.000395,
-0.000403,
-0.000403,
0.000129,
0.000129,
-0.000403,
-0.000403,
-0.000403,
-0.000403,
0.000129,
0.000129,
0.000262,
0.000262,
0.000262,
-0.000137,
-0.000137,
-0.000803,
-0.000803,
-0.000936,
-0.000936,
-0.000403,
-0.000403,
0.000262,
0.000262,
-0.000004,
0.000395,
0.000395,
0.000129,
0.000129,
0.000395,
0.000395,
-0.000004,
-0.000004,
0.000262,
0.000262,
0.000529,
0.000529,
-0.000936,
-0.000403,
-0.000403,
-0.000670,
-0.000670,
0.000129,
0.000129,
0.000129,
0.000129,
-0.000670,
-0.000670,
-0.000270,
-0.000270,
-0.000803,
-0.000004,
-0.000004,
-0.000137,
-0.000137,
-0.000403,
-0.000403,
-0.000803,
-0.000803,
-0.000270,
-0.000270,
0.000662,
0.000662,
0.000795,
0.000262,
0.000262,
-0.000270,
-0.000270,
-0.000004,
-0.000004,
-0.000137,
-0.000137,
-0.000803,
-0.000803,
-0.000403,
-0.000403,
-0.000936,
0.000129,
0.000129,
-0.000004,
-0.000004,
0.000529,
0.000529,
0.000395,
0.000395,
-0.000270,
-0.000270,
0.000129,
0.000129,
0.000529,
0.000662,
0.000662,
0.000662,
0.000662,
0.001194,
0.001194,
0.000529,
0.000529,
-0.000137,
-0.000137,
0.000129,
0.000129,
-0.000803,
0.000395,
0.000395,
-0.000004,
-0.000004,
0.000262,
0.000262,
0.000129,
0.000129,
0.000395,
0.000395,
-0.000004,
-0.000004,
-0.000803,
-0.000270,
-0.000270,
-0.000137,
-0.000137,
-0.000670,
-0.000670,
-0.001202,
-0.001202,
-0.000270,
-0.000270,
-0.001469,
-0.001469,
0.000395,
-0.000004,
-0.000004,
-0.000803,
-0.000803,
0.000129,
0.000129,
-0.000403,
-0.000403,
0.000129,
0.000129,
-0.000403,
-0.000403,
-0.000803,
0.000129,
0.000129,
0.000262,
0.000262,
-0.000004,
-0.000004,
0.000662,
0.000662,
-0.000004,
-0.000004,
0.000129,
0.000129,
-0.000537,
0.000395,
0.000395,
0.000129,
0.000129,
0.000262,
0.000262,
0.000262,
0.000262,
-0.000004,
-0.000004,
0.000395,
0.000395,
-0.000270,
0.000662,
0.000662,
0.000262,
0.000262,
0.000662,
0.000662,
0.000928,
0.000928,
-0.000803,
-0.000803,
-0.000004,
-0.000004,
0.000395,
-0.000537,
-0.000537,
-0.000403,
-0.000403,
-0.000803,
-0.000803,
-0.001069,
-0.001069,
-0.001069,
-0.001069,
0.000395,
-0.000537,
-0.000537,
-0.000403,
-0.000403,
-0.000137,
-0.000137,
-0.000137,
-0.000137,
0.000129,
0.000129,
0.000262,
0.000262,
0.000129,
0.000262,
0.000262,
0.000262,
0.000262,
-0.000137,
-0.000137,
-0.000137,
-0.000137,
-0.000137,
-0.000137,
-0.000403,
-0.000403,
-0.000803,
0.000129,
0.000129,
-0.000403,
-0.000403,
0.000129,
0.000129,
-0.000403,
-0.000403,
-0.000803,
-0.000803,
-0.000803,
-0.000803,
-0.000803,
-0.000537,
-0.000537,
-0.000137,
-0.000137,
0.000129,
0.000129,
0.000395,
0.000395,
0.000662,
0.000662,
0.000262,
0.000262,
-0.000004,
0.000129,
0.000129,
-0.001069,
-0.001069,
-0.000537,
-0.000537,
-0.000537,
-0.000537,
0.000529,
0.000529,
-0.000270,
-0.000270,
-0.000803,
0.000529,
0.000529,
0.000395,
0.000395,
-0.000537,
-0.000537,
-0.000803,
-0.000803,
0.000129,
0.000129,
-0.000270,
-0.000270,
-0.000537,
-0.000137,
-0.000137,
-0.001202,
-0.001202,
-0.000403,
-0.000403,
-0.001069,
-0.001069,
-0.001069,
-0.001069,
0.000129,
0.000129,
-0.000137,
-0.000803,
-0.000803,
-0.000803,
-0.000803,
-0.000403,
-0.000403,
-0.000537,
-0.000537,
-0.000403,
-0.000403,
-0.000270,
-0.000270,
-0.001469,
-0.000936,
-0.000936,
-0.000270,
-0.000270,
-0.000004,
-0.000004,
0.001061,
0.001061,
-0.000004,
-0.000004,
-0.000004,
-0.000004,
-0.000936,
0.000529,
0.000529,
-0.000803,
-0.000803,
-0.001202,
-0.001202,
-0.000803,
-0.000803,
-0.000137,
-0.000137,
-0.000004,
-0.000004,
-0.000004,
0.000395,
0.000395,
-0.000004,
-0.000004,
-0.000670,
-0.000670,
-0.001336,
-0.001336,
-0.000137,
-0.000137,
-0.000137,
-0.000137,
-0.000537,
-0.001469,
-0.001469,
-0.000670,
-0.000670,
0.000928,
0.000928,
0.000262,
0.000262,
-0.000403,
-0.000403,
0.000129,
0.000129,
0.000395,
0.000262,
0.000262,
0.000795,
0.000795,
0.000529,
0.000529,
0.000129,
0.000129,
-0.000403,
-0.000403,
-0.000803,
-0.000803,
-0.000537,
0.000395,
0.000395,
0.000262,
0.000262,
0.000395,
0.000395,
-0.000137,
-0.000137,
-0.000537,
-0.000537,
-0.000670,
-0.000670,
0.000395,
0.000129,
0.000129,
-0.000803,
-0.000803,
-0.000537,
-0.000537,
-0.000403,
-0.000403,
-0.000537,
-0.000537,
-0.000803,
-0.000803,
-0.000537,
0.000529,
0.000529,
0.000129,
0.000129,
-0.000936,
-0.000936,
-0.000270,
-0.000270,
0.000262,
0.000262,
0.000262,
0.000262,
-0.000270,
-0.000670,
-0.000670,
-0.000137,
-0.000137,
-0.000004,
-0.000004,
-0.000270,
-0.000270,
0.000529,
0.000529,
0.000928,
0.000928,
0.000529,
0.000529,
0.000529,
0.000262,
0.000262,
0.000262,
0.000262,
-0.000004,
-0.000004,
0.001061,
0.001061,
0.000395,
0.000395,
0.000395,
-0.000004,
-0.000004,
-0.000270,
-0.000270,
0.000262,
0.000262,
-0.000137,
-0.000137,
0.000262,
0.000262,
0.000262,
-0.000004,
-0.000004,
0.000262,
0.000262,
-0.000137,
-0.000137,
0.000395,
0.000395,
0.000395,
0.000395,
0.000529,
0.000529,
-0.000270,
-0.000403,
-0.000403,
0.000129,
0.000129,
0.001061,
0.001061,
0.001061,
0.001061,
0.000129,
0.000129,
0.000795,
0.000795,
0.000928,
0.001061,
0.001061,
-0.000670,
-0.000670,
-0.000403,
-0.000403,
0.000129,
0.000129,
0.000662,
0.000662,
-0.000537,
-0.000537,
-0.000403,
0.000129,
0.000129,
-0.001202,
-0.001202,
-0.000270,
-0.000270,
-0.000403,
-0.000403,
0.000129,
0.000129,
0.000529,
0.000529,
-0.000270,
0.000395,
0.000395,
-0.000936,
-0.000936,
-0.000670,
-0.000670,
-0.000137,
-0.000137,
-0.001069,
-0.001069,
-0.000803,
-0.000803,
0.000129,
0.000395,
0.000395,
-0.000403,
-0.000403,
-0.000137,
-0.000137,
-0.000803,
-0.000803,
-0.001202,
-0.001202,
0.000262,
0.000262,
0.000262,
};

float buf[FILTER_LENGTH];
FIRFilter lpbf;
float out[sizeof(in)/sizeof(float)];
float *ptrOut = &out[0];

string truncate(float val, int numDigits)
{
  std::string output = std::to_string(val).substr(0, numDigits+1);
  if (output.find('.') ==  string::npos ||
      output.back() == '.')
  {
    output.pop_back();
  }
  return output;
}

int main()
{
    std::ofstream outFile;

    // Open the file
    outFile.open("Filtered.csv");

    // Check if the file was successfully opened
    if (!outFile) {
        std::cerr << "Error opening file\n";
        return 1; // Return an error code
    }

    FIRFilter_Init(&lpbf, coeff, buf, FILTER_LENGTH );
    for(int i = 0; i < (sizeof(in)/sizeof(float)); i++)
    {
        *ptrOut = FIRFilter_Update(&lpbf,in[i]);

        outFile << i << "," << truncate(*ptrOut,8) << std::endl;
        ptrOut++;
    }
    // Close the file
    outFile.close();
    return 0;
}
